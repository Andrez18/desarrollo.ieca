---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

const projects = await getCollection("projects");

const years = Array.from(
  new Set(projects.map((p) => p.data.developedyear))
).sort((a, b) => b - a);
---

<Layout title="Proyectos - Desarrollo IECA">
  <Header />
  
  <!-- Primera secci√≥n - Hero -->
  <section class="min-h-screen px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
      <!-- T√≠tulo principal -->
      <div class="text-center py-8 sm:py-12">
        <h1 class="text-6xl sm:text-8xl md:text-9xl lg:text-[150px] xl:text-[200px] 2xl:text-[230px] font-regular tracking-[-2px] sm:tracking-[-3px] lg:tracking-[-5px] text-white leading-none">
          PROYECTOS
        </h1>
      </div>

      <!-- Bloques de descripci√≥n -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-18 mb-12 lg:mb-16">
        <div class="text-center md:text-left">
          <p class="text-[var(--text-blue-light)] text-base sm:text-lg md:text-xl leading-[129.7%] tracking-[-1px] mx-auto md:mx-0 max-w-sm">
            Conoce los proyectos<br />
            desarrollados por nuestros<br />
            estudiantes.
          </p>
        </div>
        <div class="text-center md:text-right">
          <p class="text-[var(--text-blue-light)] text-base sm:text-lg md:text-xl leading-[129.7%] tracking-[-1px] mx-auto md:mx-0 max-w-sm md:ml-auto">
            Clasifica y explora los<br />
            proyectos por los que m√°s<br />
            te interesan.
          </p>
        </div>
      </div>

      <!-- Imagen principal -->
      <div class="w-full overflow-hidden rounded-lg">
        <img
          src="/image-1-projects.png"
          alt="Estudiante programando en laptop con c√≥digo en pantalla"
          class="w-full h-[200px] sm:h-[250px] md:h-[300px] lg:h-[350px] xl:h-[400px] 2xl:h-[266px] object-cover"
        />
      </div>
    </div>
  </section>

  <!-- Segunda secci√≥n - Filtros y proyectos -->
  <section aria-label="Los proyectos m√°s destacados" class="bg-gray-100 text-gray-900 py-8 sm:py-12 px-4 sm:px-6 mt-8 sm:mt-12">
    <!-- Header con filtros -->
    <header class="max-w-6xl mx-auto mb-8 sm:mb-12">
      <div class="mb-6">
        <h2 class="text-xl sm:text-2xl font-medium mb-4">Filtrar por</h2>
    
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 sm:gap-6">
          <div class="flex flex-col sm:flex-row gap-4 w-full sm:w-auto">
            <!-- Select A√±o -->
            <div class="relative">
              <select
                id="yearFilter"
                class="appearance-none px-4 py-2 rounded-full border border-black text-base sm:text-lg font-medium pr-8 focus:outline-none w-full sm:w-auto min-w-[120px]"
              >
                <option value="">A√±o</option>
                {years.map((year) => (
                  <option value={year}>{year}</option>
                ))}
              </select>
              <span class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-black">‚åÑ</span>
            </div>
          </div>
        
          <!-- Buscador -->
          <div class="relative w-full sm:w-48">
            <input
              type="text"
              id="search"
              placeholder="Buscar"
              class="w-full px-4 py-2 pr-10 rounded-full border border-black text-base sm:text-xl font-medium focus:outline-none"
            />
            <span class="absolute right-3 top-1/2 -translate-y-1/2 text-black">
              <i class="fa-solid fa-magnifying-glass"></i>
            </span>
          </div>
        </div>
      </div>
    </header>

    <!-- Contenido principal -->
    <div class="flex flex-col lg:flex-row pt-4 sm:pt-8 gap-8 lg:gap-12 max-w-6xl mx-auto">
      <!-- Lado izquierdo - Info destacados -->
      <div class="lg:w-1/3">
        <h2 class="text-[#1e1e1e] text-2xl sm:text-3xl lg:text-[40px] font-medium uppercase tracking-[-0.05em] leading-[120.8%] mb-3">
          Proyectos Destacados
        </h2>
        <p class="text-[#2e2e2e] text-lg sm:text-xl lg:text-2xl leading-[120.8%] tracking-[-0.02em] mb-6">
          Algunos de nuestros proyectos destacados y m√°s completos en cuanto a funcionalidad
        </p>

        <a
          href="#"
          class="inline-flex items-center gap-2 text-[var(--text-light)] bg-[var(--background-dark)] rounded-[20px] w-full sm:w-[200px] h-[42px] text-center justify-center uppercase font-medium transition-all duration-500 ease-in-out hover:scale-105"
        >
          Mostrar todos
          <span class="flex items-center justify-center bg-[var(--text-light)] rounded-full w-[40px] h-[40px]">
            <i class="fa-solid fa-arrow-right text-[15.4px] text-[var(--text-dark)]"></i>
          </span>
        </a>
      </div>

      <!-- Grid de proyectos -->
      <div class="lg:w-2/3 space-y-8 sm:space-y-12">
        {projects.map((project, index) => {
          const { slug, data } = project;
          const { title, description, img } = data;
          const num = String(index + 1).padStart(2, "0");

          return (
            <article
              class="project-item grid grid-cols-1 lg:grid-cols-10 items-start gap-4 sm:gap-6 pb-4 border-b border-gray-200 last:border-b-0"
              key={slug}
              data-title={title.toLowerCase()}
              data-description={description.toLowerCase()}
              data-year={data.developedyear}
            >
              {/* Imagen izquierda si index impar - solo en desktop */}
              {index % 2 !== 0 && (
                <div class="hidden lg:block lg:col-span-3 lg:col-start-2 order-1">
                  <img src={img} alt={title} class="w-full max-w-[210px] h-[150px] sm:h-[180px] object-cover rounded-lg" />
                  <p class="text-[10px] sm:text-[11px] uppercase text-gray-500 mt-1">
                    Imagen del desarrollo
                  </p>
                </div>
              )}

              {/* Contenido */}
              <div class={`lg:col-span-7 flex flex-col gap-3 order-2 ${index % 2 !== 0 ? "lg:text-right lg:col-start-5" : "order-1"}`}>
                {/* Imagen en m√≥vil - siempre arriba */}
                <div class="lg:hidden mb-4">
                  <img src={img} alt={title} class="w-full max-w-[300px] h-[180px] object-cover rounded-lg mx-auto" />
                  <p class="text-[11px] uppercase text-gray-500 mt-1 text-center">
                    Imagen del desarrollo
                  </p>
                </div>

                {/* Encabezado con n√∫mero din√°mico */}
                <div class={`flex flex-col sm:flex-row items-start sm:items-baseline gap-2 ${index % 2 !== 0 ? "lg:justify-end" : ""}`}>
                  <span class="text-[#1919199C] text-sm sm:text-[15px] font-light order-1 sm:order-none">
                    /{num}
                  </span>
                  <h3 class="text-2xl sm:text-3xl lg:text-4xl xl:text-[48px] font-medium uppercase text-[var(--text-dark)] leading-tight">
                    {title}
                  </h3>
                </div>

                {/* Descripci√≥n */}
                <p class="text-[#1e1e1e] font-regular text-lg sm:text-xl lg:text-2xl xl:text-[24px] leading-[128.7%] tracking-[-1%]">
                  {description}
                </p>

                {/* Enlaces */}
                <div class={`flex flex-col sm:flex-row gap-4 sm:gap-6 text-sm font-medium text-[var(--text-blue-dark)] uppercase mt-2 ${index % 2 !== 0 ? "lg:justify-end" : ""}`}>
                  <a href="#" class="hover:underline transition-colors">
                    Explorar repositorio
                  </a>
                  <a href={`/projects/${slug}`} class="hover:underline transition-colors">
                    Ir al proyecto ‚Üó
                  </a>
                </div>
              </div>

              {/* Imagen derecha si index par - solo en desktop */}
              {index % 2 === 0 && (
                <div class="hidden lg:block lg:col-span-3 order-3 ml-auto">
                  <img src={img} alt={title} class="w-full max-w-[210px] h-[150px] sm:h-[180px] object-cover rounded-lg" />
                  <p class="text-[10px] sm:text-[11px] uppercase text-gray-500 mt-1">
                    Imagen del desarrollo
                  </p>
                </div>
              )}
            </article>
          );
        })}
      </div>
    </div>

    <p id="noResults" class="text-center text-gray-500 mt-6 hidden">
      No se encontr√≥ ning√∫n proyecto
    </p>
  </section>
  
  <Footer />
</Layout>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const searchInput = document.getElementById("search");
    const yearFilter = document.getElementById("yearFilter");
    const projects = document.querySelectorAll(".project-item");
    const noResults = document.getElementById("noResults");

    // üîπ Ocultar todos menos los 3 primeros inicialmente
    projects.forEach((project, index) => {
      if (index >= 3) {
        project.style.display = "none";
      }
    });

    function filtrar() {
      const search = searchInput?.value.toLowerCase() || "";
      const year = yearFilter?.value || "";

      let visibleCount = 0;

      projects.forEach((project, index) => {
        const title = project.dataset.title || "";
        const description = project.dataset.description || "";
        const projectYear = project.dataset.year || "";

        const coincideBusqueda = !search || title.includes(search) || description.includes(search);
        const coincideYear = !year || projectYear === year;

        if (coincideBusqueda && coincideYear) {
          project.style.display = "block";
          visibleCount++;
        } else {
          project.style.display = "none";
        }
      });

      // Mostrar/ocultar mensaje de no resultados
      if (visibleCount === 0) {
        noResults?.classList.remove("hidden");
      } else {
        noResults?.classList.add("hidden");
      }
    }

    // Eventos
    searchInput?.addEventListener("input", filtrar);
    searchInput?.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        filtrar();
      }
    });

    yearFilter?.addEventListener("change", filtrar);
  });
</script>